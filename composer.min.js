(function(){"use strict";var e=this;if(!e.Composer)e.Composer={exp0rt:function(t){Object.keys(t).forEach(function(n){e.Composer[n]=t[n]})}};var t=function(e,t,n){return n.success()};var n=function(){var e=1;return function(t){return"c"+e++}}();var r=function(e,t,n){return function(r){if(e){e(t,r,n)}else{this.fire_event("error",n,t,r,n)}}};var i=function(e,t){if(e===t)return true;if(e instanceof Function)return false;if(typeof e!=typeof t)return false;if(e&&e.constructor&&!t||!t.constructor)return false;if(t&&t.constructor&&!e||!e.constructor)return false;if(e&&t&&e.constructor!=t.constructor)return false;if(e instanceof Array||Object.prototype.toString.call(e)==="[object Array]"){if(e.length!=t.length)return false;for(var n=0,r=e.length;n<r;n++){if(!t.hasOwnProperty(n))return false;if(!i(e[n],t[n]))return false}}else if(e instanceof Object){for(var s in t){if(t.hasOwnProperty(s)&&!e.hasOwnProperty(s))return false}for(var s in e){if(!e.hasOwnProperty(s))continue;if(!t.hasOwnProperty(s))return false;if(e[s]===t[s])continue;if(typeof e[s]!=="object")return false;if(!i(e[s],t[s]))return false}}else if(e!=t){return false}return true};var s=function(e,t){var n=e.extend;e.extend=function(e,r){r||(r=this);var i=r.prototype;t.forEach(function(t){e[t]=Composer.object.merge({},i[t],e[t])});var s=n.call(r,e);Composer.merge_extend(s,t);return s}};var o={erase:function(e,t){for(var n=e.length-1;n>=0;n--){if(e[n]===t)e.splice(n,1)}},is:function(){return"isArray"in Array?Array.isArray:function(e){return e instanceof Array||Object.prototype.toString.call(e)==="[object Array]"}}()};var u={each:function(e,t,n){if(!e)return;n||(n=this);Object.keys(e).forEach(function(r){t.bind(n)(e[r],r)})},clone:function(e){var t={};Object.keys(e).forEach(function(n){t[n]=e[n]});return t},merge:function(e,t){var n=Array.prototype.slice.call(arguments,1);n.forEach(function(t){if(!t)return;Object.keys(t).forEach(function(n){e[n]=t[n]})});return e}};Composer.exp0rt({sync:t,cid:n,wrap_error:r,eq:i,merge_extend:s,array:o,object:u})}).apply(typeof exports!="undefined"?exports:this);(function(e){"use strict";function d(e){c.apply(this,arguments);this.message=n+"::"+e}function v(e){c.apply(this,arguments);this.message=n+"::Parent Class doesn't have the method: "+e}function m(){}function g(e){return m.extend(e)}function y(e){return!!(e&&e.extend===m.extend)}function b(){function r(i){var s=this;Object.keys(s.__static).forEach(function(e){var t=s.__static[e];if(t instanceof Function)return;if(t instanceof Array){t=t.slice(0)}else if(t instanceof Object){var n={};Object.keys(t).forEach(function(e){n[e]=t[e]});t=n}s[e]=t});if(s instanceof r){if(t===false){if(n!==s.initialize){if("initialize"in s&&u.call(s.initialize)===f){n=s.initialize}else{n=e}}if(n!==e){n.apply(s,i&&i.callee===r?i:arguments)}}}else{return new r(arguments)}}var n;return r}function w(e,t,n,i){var s=o.test(t),l=s,c=u.call(n)===f?function(){return n.apply(this,arguments)}:function(){throw new v(e)};return function(){var e=this,n=e.parent,o,u,f;e.parent=c;if(l){if(s){s=false;f=i();for(u in f){if(a.call(f,u)){c[u]=f[u]}}}c[r]=e}o=t.apply(e,arguments);e.parent=n;return o}}function E(e){return function(){return e.apply(this[r],arguments)}}function S(t,n,r){var i,o,l,c=function(){if(l===e){var t;l={};for(t in n){if(u.call(n[t])===f){l[t]=E(n[t])}}}return l};if(r===e){r=n}r.__static=Composer.object.clone(n.__static||{});for(i in t){if(a.call(t,i)){o=t[i];if(!(o instanceof Function)||n&&n.__static&&!(n.__static[i]instanceof Function)){r.__static[i]=o}r[i]=u.call(o)===f&&s.test(o)?w(i,o,n[i],c):o}}}var t=false,n="Class",r=n+(new Date).getTime(),i=function(){this.parent()},s=/\bparent\b/,o=s.test(i)?/\bparent\b\./:s=/.*/,u=Object.prototype.toString,a=Object.prototype.hasOwnProperty,f=u.call(i),l=u.call({}),c=Error,h,p={};h=d.prototype=new c;p[h.name="InvalidClassDefinition"]=d;h=v.prototype=new c;p[h.name="InvalidParentMethodCall"]=v;m.extend=function(e){var n=b(),r,i=this,s,o=i.prototype,f;if(!e||u.call(e)!==l){f="Unable to "+(i===m?"extend":"create")+" class";throw new d(f)}for(r in i){if(a.call(i,r)){n[r]=i[r]}}if(e.hasOwnProperty("prototype")){s=e.prototype;if(s&&u.call(s)===l){delete e.prototype;S(e,i,n);e=e.prototype=s}else{f="Invalid type on properties.prototype("+s+"), literal object expected";throw new d(f)}}t=true;s=new i;t=false;S(e,o,s);n.constructor=s.constructor=n;n.prototype=s;n.inherits=function(e){return e===i||i.inherits(e)};return n};m.inherits=function(){return false};m.addMethods=function(e,t,n){if(e&&u.call(e)===l){t=e.prototype;n=this.prototype;if(t&&u.call(t)===l){S(t,n);delete e.prototype;S(e,this);e.prototype=t}else{S(e,n)}}else{throw new d("Unable to add methods to class")}};m.prototype.addMethods=function(e){if(e&&u.call(e)===l){S(e,this)}else{throw new d("Unable to add methods to instance")}};g.is=y;g.makeClass=b;g.fnSearch=s;g.parentFnSearch=o;g.errors=p;g.version="1.1.0";Composer.exp0rt({Class:g})})();(function(e,t){"use strict";var n=function(e,t){return e+"@"+t};var r=Composer.Class({_handlers:{},_handler_names:{},_forwards:[],forward:function(e){this._forwards.push(e);return this},forwards_to:function(e){return this._forwards.indexOf(e)>=0},unforward:function(e){var t=this._forwards.indexOf(e);if(t<0)return this;this._forwards.splice(t,1);return this},bind:function(e,t,r){if(Composer.array.is(e)){e.forEach(function(e){this.bind(e,t,r)}.bind(this));return this}if(r)this.unbind(e,r);if(!this._handlers[e])this._handlers[e]=[];var i=this._handlers[e];i.push(t);if(r){this._handler_names[n(e,r)]=t}return this},bind_once:function(e,t,n){n||(n=null);var r=function(){this.unbind(e,r);t.apply(this,arguments)}.bind(this);return this.bind(e,r,n)},unbind:function(e,t){if(!e)return this.wipe();if(Composer.array.is(e)){e.forEach(function(e){this.unbind(e,t)}.bind(this));return this}if(!t)return this.unbind_all(e);var r=t instanceof Function;var i=r?null:n(e,t);var s=r?t:this._handler_names[i];if(!s)return this;if(!r)delete this._handler_names[i];var o=this._handlers[e].indexOf(s);if(o<0)return this;this._handlers[e].splice(o,1);return this},unbind_all:function(e){delete this._handlers[e];return this},wipe:function(e){e||(e={});this._handlers={};this._handler_names={};if(!e.preserve_forwards)this._forwards=[];return this},trigger:function(e,t){var n=Array.prototype.slice.call(arguments,0);var i=this._handlers[e]||[];var s=this._handlers["all"]||[];i.slice(0).forEach(function(e){e.apply(this,n.slice(1))}.bind(this));s.slice(0).forEach(function(e){e.apply(this,n.slice(0))}.bind(this));if(this._forwards.length>0){this._forwards.forEach(function(e){if(e instanceof r){e.trigger.apply(e,n)}else if(e instanceof Function){var e=e.apply(e,n);if(e instanceof r){e.trigger.apply(e,n)}}})}return this}});r._make_lookup_name=n;Composer.exp0rt({Event:r})}).apply(typeof exports!="undefined"?exports:this);(function(){"use strict";var e=Composer.Event.extend({__composer_type:"base",options:{},_cid:false,initialize:function(){this._cid=Composer.cid()},cid:function(){return this._cid},set_options:function(e){e||(e={});Object.keys(e).forEach(function(t){this.options[t]=e[t]}.bind(this))},fire_event:function(){var e=Array.prototype.slice.call(arguments,0);var t=e.shift();var n=e.shift();n||(n={});e.unshift(t);if(!n.silent&&!n.not_silent){return this.trigger.apply(this,e)}else if(n.not_silent&&(n.not_silent==t||n.not_silent.indexOf&&n.not_silent.indexOf(t)>=0)){return this.trigger.apply(this,e)}else if(n.silent&&(typeof n.silent=="string"&&n.silent!=t||n.silent.indexOf&&!(n.silent.indexOf(t)>=0))){return this.trigger.apply(this,e)}return this}});Composer.exp0rt({Base:e})})();(function(){"use strict";var e=Composer.Base.extend({__composer_type:"model",defaults:{},data:{},_changed:false,collections:[],id_key:"id",url:false,base_url:false,validate:function(e,t){return false},initialize:function(e,t){e||(e={});var n={};var r=function(e,t){n[t]=e};Composer.object.each(Composer.object.clone(this.defaults),r);Composer.object.each(e,r);this.parent();this.set(n,t);this.init(t)},init:function(){},get:function(e,t){if(typeof t=="undefined")t=null;if(typeof this.data[e]=="undefined"){return t}return this.data[e]},escape:function(e){var t=this.get(e);if(t==null||typeof t!="string"){return t}return t.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(e){return this.data[e]!=null},set:function(e,t){t||(t={});if(!t.silent&&!this.perform_validation(e,t))return false;var n=this.changing;this.changing=true;Composer.object.each(e,function(e,n){if(!Composer.eq(e,this.data[n])){this.data[n]=e;this._changed=true;this.fire_event("change:"+n,t,this,e,t)}}.bind(this));if(!n&&this._changed){this.fire_event("change",t,this,t,e);this._changed=false}this.changing=false;return this},unset:function(e,t){if(!(e in this.data))return this;t||(t={});var n={};n[e]=void 0;if(!t.silent&&!this.perform_validation(n,t))return false;delete this.data[e];this._changed=true;this.fire_event("change:"+e,t,this,void 0,t);this.fire_event("change",t,this,t);this._changed=false;return this},clear:function(e){e||(e={});var t=this.data;var n={};for(var r in t)n[r]=void 0;if(!e.silent&&!this.perform_validation(n,e))return false;this.data={};if(!e.silent){for(var r in t){this._changed=true;this.fire_event("change"+r,e,this,void 0,e)}if(this._changed){this.fire_event("change",e,this,e);this._changed=false}}return this},fetch:function(e){e||(e={});var t=e.success;e.success=function(n){this.set(this.parse(n),e);if(t)t(this,n)}.bind(this);e.error=Composer.wrap_error(e.error?e.error.bind(this):null,this,e).bind(this);return(this.sync||Composer.sync).call(this,"read",this,e)},save:function(e){e||(e={});if(!this.perform_validation(this.data,e))return false;var t=e.success;e.success=function(n){if(!this.set(this.parse(n),e))return false;if(t)t(this,n)}.bind(this);e.error=Composer.wrap_error(e.error?e.error.bind(this):null,this,e).bind(this);return(this.sync||Composer.sync).call(this,this.is_new()?"create":"update",this,e)},destroy:function(e){e||(e={});var t=e.success;e.success=function(n){this.fire_event("destroy",e,this,this.collections,e);if(t)t(this,n)}.bind(this);if(this.is_new()&&!e.force)return e.success();e.error=Composer.wrap_error(e.error?e.error.bind(this):null,this,e).bind(this);return(this.sync||Composer.sync).call(this,"delete",this,e)},parse:function(e){return e},id:function(e){if(typeof e!="boolean")e=false;var t=this.get(this.id_key);if(t)return t;if(e)return false;return this.cid()},is_new:function(){return!this.id(true)},clone:function(){return new this.constructor(this.toJSON())},toJSON:function(){return Composer.object.clone(this.data)},perform_validation:function(e,t){if(typeof this.validate!="function")return true;var n=this.validate(e,t);if(n){if(t.error){t.error(this,n,t)}else{this.fire_event("error",t,this,n,t)}return false}return true},highest_priority_collection:function(){var e=this.collections.slice(0);e.sort(function(e,t){return t.priority-e.priority});return e.length?e[0]:false},get_url:function(){if(this.url)return this.url;if(this.base_url)var e=this.base_url;else{var t=this.highest_priority_collection();if(t)var e=t.get_url();else var e=""}var n=this.id(true);if(n)n="/"+n;else n="";var r=e?"/"+e.replace(/^\/+/,"").replace(/\/+$/,"")+n:n;return r}});Composer.exp0rt({Model:e})})();(function(){"use strict";var e=this;var t=Composer.Base.extend({__composer_type:"collection",model:Composer.Model,_models:[],sortfn:null,url:"/mycollection",priority:1,initialize:function(t,n,r){n||(n={});for(var i in n){this[i]=n[i]}this.parent();this.model=typeof this.model=="string"?e[this.model]:this.model;if(t){this.reset(t,r)}this.init()},init:function(){},toJSON:function(){return this.models().map(function(e){return e.toJSON()})},models:function(){return this._models},size:function(){return this.models().length},add:function(e,t){if(Composer.array.is(e)){return Composer.object.each(e,function(e){this.add(e,t)},this)}t||(t={});var n=e instanceof Composer.Model?e:new this.model(e,t);if(n.collections.indexOf(this)==-1){n.collections.push(this);t.is_new=true}if(this.sortfn){var r=t.at?parseInt(t.at):this.sort_index(n);this._models.splice(r,0,n)}else{if(typeof t.at=="number")this._models.splice(t.at,0,n);else this._models.push(n)}n.bind("all",this._model_event.bind(this),"collection:"+this.cid()+":listen:model:all");this.fire_event("add",t,n,this,t);return n},remove:function(e,t){if(Composer.array.is(e)){return Composer.object.each(e,function(e){this.remove(e)},this)}if(!e)return;t||(t={});Composer.array.erase(e.collections,this);var n=this._models.length;Composer.array.erase(this._models,e);if(this._models.length!=n){this.fire_event("remove",t,e)}this._remove_reference(e)},upsert:function(e,t){t||(t={});var n=this.find_by_id(e.id(),t);if(n){var r=this.index_of(n);if(typeof t.at=="number"&&r!=t.at){this._models.splice(r,1);this._models.splice(t.at,0,n);this.fire_event("sort",t)}n.set(e.toJSON(),Composer.object.merge({},{silent:true,upsert:true},t));this.fire_event("upsert",t,n,t);return n}this.add(e,t);return e},clear:function(e){e||(e={});var t=this._models.length;if(t==0)return;this.remove(this._models,e);this._models=[];if(this._models.length!=t){this.fire_event("clear",e)}},reset:function(e,t){t||(t={});if(!t.append)this.clear(t);this.add(e,t);this.fire_event("reset",t,t)},reset_async:function(e,t){t||(t={});if(e==undefined)return;if(!Composer.array.is(e))e=[e];e=e.slice(0);if(!t.append)this.clear();if(e.length>0){this.add(e[0],t);e.shift()}if(e.length==0){this.fire_event("reset",t,t);if(t.complete)t.complete();return}setTimeout(function(){this.reset_async(e,Composer.object.merge({append:true},t))}.bind(this),0)},sort:function(e){if(!this.sortfn)return false;this._models.sort(this.sortfn);this.fire_event("reset",e,e)},sort_index:function(e){if(!this.sortfn)return false;if(this._models.length==0)return 0;for(var t=0;t<this._models.length;t++){if(this.sortfn(this._models[t],e)>0){return t}}var n=this._models.indexOf(e);if(n==this._models.length-1)return n;return this._models.length},parse:function(e){return e},each:function(e,t){t||(t=this);this.models().forEach(e.bind(t))},map:function(e,t){t||(t=this);return this.models().map(e.bind(t))},find:function(e,t){if(t){var n=this.models().slice(0).sort(t)}else{var n=this.models()}for(var r=0;r<n.length;r++){var i=n[r];if(e(i)){return i}}return false},exists:function(e){for(var t=0;t<this.models().length;t++){if(e(this.models()[t]))return true}return false},find_by_id:function(e,t){t||(t={});return this.find(function(n){if(n.id(t.strict)==e){return true}if(t.allow_cid&&n.cid()==e){return true}})},find_by_cid:function(e){return this.find(function(t){if(t.cid()==e){return true}})},index_of:function(e){var t=e.__composer_type=="model"?e.id():e;for(var n=0;n<this._models.length;n++){if(this._models[n].id()==t){return n}}return false},filter:function(e,t){t||(t=this);return this._models.filter(e.bind(t))},select:function(e){if(typeof e=="object"){var t=e;var n=Object.keys(t);e=function(e){for(var r=0;r<n.length;r++){var i=n[r];var s=t[i];if(e.get(i)!==s)return false}return true}}return this._models.filter(e)},select_one:function(e){var t=this.select(e);if(t.length)return t[0];return null},first:function(e){var t=this.models();return typeof e!="undefined"&&parseInt(e)!=0?t.slice(0,e):t[0]},last:function(e){var t=this.models();return typeof e!="undefined"&&parseInt(e)!=0?t.slice(t.length-e):t[t.length-1]},at:function(e){var t=this._models[e];return t||false},fetch:function(e){e||(e={});var t=e.success;e.success=function(n){this.reset(this.parse(n),e);if(t)t(this,n)}.bind(this);e.error=Composer.wrap_error(e.error?e.error.bind(this):null,this,e).bind(this);return(this.sync||Composer.sync).call(this,"read",this,e)},get_url:function(){return this.url},_remove_reference:function(e){Composer.array.erase(e.collections,this);e.unbind("all","collection:"+this.cid()+":listen:model:all")},_model_event:function(e,t,n,r){if((e=="add"||e=="remove")&&!(n.indexOf(this)>=0))return;if(e=="destroy"){this.remove(t,r)}this.trigger.apply(this,arguments)}});Composer.exp0rt({Collection:t})}).apply(typeof exports!="undefined"?exports:this);(function(){"use strict";var e=this;var t=!!e.Sizzle;var n=!!e.jQuery;var r=!!e.Slick;var i=!!e.MooTools;var s=function(){if(i){return function(e,t){e||(e=document);return document.id(e).getElement(t)}}else if(t){return function(e,t){e||(e=document);return Sizzle.select(t,e)[0]}}else if(r){return function(e,t){e||(e=document);return Slick.find(e,t)}}else if(n){return function(e,t){e||(e=document);return jQuery(e).find(t)[0]}}throw new Error("No selector engine present. Include Sizzle/jQuery or Slick/Mootools before loading composer.")}();var o=function(){if(t){return function(e,t){e||(e=document);return Sizzle.matchesSelector(e,t)}}else if(r){return function(e,t){e||(e=document);return Slick.match(e,t)}}else if(n){return function(e,t){e||(e=document);return jQuery(e).is(t)}}throw new Error("No selector engine present. Include Sizzle/jQuery or Slick/Mootools before loading composer.")}();var u=function(){if(n){return function(e,t,n,r){if(r)return jQuery(e).on(t,r,n);else return jQuery(e).on(t,n)}}else if(i){return function(e,t,n,r){var i=n;n=function(){i.apply(this,arguments)};if(r)return document.id(e).addEvent(t+":relay("+r+")",n);else return document.id(e).addEvent(t,n)}}else{return function(e,t,n,r){if(r){e.addEventListener(t,function(e){var t=e.target||e.srcElement;if(e.__composer_handled||!o(t,r))return false;e.__composer_handled=true;n.apply(this,[e].concat(e.params||[]))})}else{e.addEventListener(t,function(e){n.apply(this,[e].concat(e.params||[]))},false)}}}}();var a=function(){if(n){return function(e,t,n){jQuery(e).off(t,n)}}else if(i){return function(e,t,n){document.id(e).removeEvent(t,n)}}else{return function(e,t,n){e.removeEventListener(t,n,false)}}}();var f=function(){return function(e,t,n){n||(n={});if(t=="click"&&e.click){return e.click()}var r;if(e.ownerDocument){r=e.ownerDocument}else if(e.nodeType==9){r=e}else{throw new Error("Invalid node passed to fireEvent: "+e.id)}if(e.dispatchEvent){var i="";switch(t){case"click":case"mousedown":case"mouseup":i="MouseEvents";break;case"focus":case"change":case"blur":case"select":i="HTMLEvents";break;case"keyup":case"keydown":i="KeyboardEvent";break;default:throw"fireEvent: Couldn't find an event class for event '"+t+"'.";break}var s=true;var o=r.createEvent(i);o.initEvent(t,s,true);o.synthetic=true;e.dispatchEvent(o,true)}else if(e.fireEvent){var o=r.createEventObject();o.synthetic=true;e.fireEvent("on"+t,o)}}}();var l=function(e,t){if(o(t,e))return t;var n=t.parentNode;return l(e,n)};Composer.exp0rt({find:s,match:o,add_event:u,fire_event:f,remove_event:a,find_parent:l})}).apply(typeof exports!="undefined"?exports:this);(function(){"use strict";var e=Composer.Base.extend({__composer_type:"controller",_bound_events:[],_subcontrollers:{},el:false,inject:false,tag:"div",elements:{},events:{},initialize:function(e,t){t||(t={});for(var n in e){this[n]=e[n]}this.parent();this._ensure_el();if(this.inject){this.attach(t)}if(this.className){this.el.className+=" "+this.className}this.refresh_elements();this.delegate_events();this.init()},init:function(){},render:function(){return this},html:function(e){if(!this.el)this._ensure_el();if(e.appendChild&&e.tagName){this.el.innerHTML="";this.el.appendChild(e)}else{this.el.innerHTML=e}this.refresh_elements()},attach:function(e){e||(e={});this._ensure_el();var t=typeof this.inject=="string"?Composer.find(document,this.inject):this.inject;if(!t)return false;if(e.clean_injection)t.innerHTML="";t.appendChild(this.el)},with_bind:function(e,t,n,r){r||(r=false);e.bind(t,n,r);this._bound_events.push([e,t,n])},track_subcontroller:function(e,t){if(this._subcontrollers[e]){this._subcontrollers[e].release();delete this._subcontrollers[e]}var n=t();this._subcontrollers[e]=n;return n},get_subcontroller:function(e){return this._subcontrollers[e]||false},_ensure_el:function(){if(typeof this.el=="string"){this.el=Composer.find(document,this.el)}this.el||(this.el=document.createElement(this.tag))},release:function(e){e||(e={});if(this.el&&this.el.parentNode)this.el.parentNode.removeChild(this.el);this.el=false;this._bound_events.forEach(function(e){var t=e[0];var n=e[1];var r=e[2];t.unbind(n,r)});this._bound_events=[];Object.keys(this._subcontrollers).forEach(function(e){this._subcontrollers[e].release()}.bind(this));this._subcontrollers={};this.fire_event("release",e,this);if(!e.keep_events)this.unbind()},replace:function(e){if(this.el.parentNode)this.el.parentNode.replaceChild(e,this.el);this.el=e;this.refresh_elements();this.delegate_events();return e},delegate_events:function(){for(var e in this.events){var t=this[this.events[e]];if(typeof t!="function"){continue}t=t.bind(this);var n=e.match(/^(\w+)\s*(.*)$/);var r=n[1].trim();var i=n[2].trim();if(i==""){Composer.remove_event(this.el,r,t);Composer.add_event(this.el,r,t)}else{Composer.add_event(this.el,r,t,i)}}},refresh_elements:function(){if(!this.elements)return false;Object.keys(this.elements).forEach(function(e){var t=this.elements[e];this[t]=Composer.find(this.el,e)}.bind(this))}});Composer.merge_extend(e,["events","elements"]);Composer.exp0rt({Controller:e})})();(function(e,t){"use strict";var e=this;var n=Composer.Base.extend({__composer_type:"router",last_path:false,_last_url:null,routes:{},options:{suppress_initial_route:false,enable_cb:function(e){return true},process_querystring:false,base:false},initialize:function(t,n){this.set_options(n);this.routes=t;this.bind("route",this._do_route.bind(this));if(!e.History)e.History={enabled:false};if(!History.enabled)throw"History.js is *required* for proper router operation: https://github.com/browserstate/history.js";this.bind("statechange",this.state_change.bind(this));this.bind_once("destroy",function(){Object.keys(History.Adapter.handlers).forEach(function(e){delete History.Adapter.handlers[e]});delete e["onstatechange"]});History.Adapter.bind(e,"statechange",function(e){e||(e=[this.cur_path()]);var t=e[0];var n=e[1];this.trigger("statechange",t,n)}.bind(this));if(!this.options.suppress_initial_route){History.Adapter.trigger(e,"statechange",[this.cur_path()])}},destroy:function(){this.trigger("destroy");this.unbind()},debasify:function(e){if(this.options.base&&e.indexOf(this.options.base)==0){e=e.substr(this.options.base.length)}return e},cur_path:function(){if(History.emulated.pushState){var t="/"+(new String(e.location.hash)).toString().replace(/^[#!\/]+/,"")}else{var t=e.location.pathname+e.location.search}return this.debasify(t)},get_param:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)");var r=n.exec(e);return r==null?null:decodeURIComponent(r[1].replace(/\+/g," "))},route:function(e,t){e||(e=this.cur_path());t||(t={});t.state||(t.state={});var n=this.options.base||"";var r=n+"/"+e.trim().replace(/^[a-z]+:\/\/.*?\//,"").replace(/^[#!\/]+/,"");var i=n+this.cur_path();if(i==r){this.trigger("statechange",r,true)}else if(History.emulated.pushState){History.saveHash(e);window.location.hash="#"+r;this.trigger("statechange",r,true)}else{if(t.replace_state){History.replaceState(t.state,"",r)}else{History.pushState(t.state,"",r)}}},_do_route:function(t,n){if(!this.options.enable_cb(t)){return false}n||(n=this.routes);var r=this.find_matching_route(t,n);if(!r){return this.trigger("fail",{url:t,route:false,handler_exists:false,action_exists:false})}var i=r.route;var s=r.args;var o=i[0];var u=i[1];if(typeof o!="object"){if(!e[o]){return this.trigger("fail",{url:t,route:i,handler_exists:false,action_exists:false})}var o=e[o]}if(!o[u]||typeof o[u]!="function"){return this.trigger("fail",{url:t,route:i,handler_exists:true,action_exists:false})}var a=s;a.shift();this._last_url=t;this.trigger("route-success",i);o[u].apply(o,a)},find_matching_route:function(e,t){var e="/"+e.replace(/^!?\//g,"");var n=false;var r=[];var i=null;for(var s in t){i=new RegExp("^"+s.replace(/\//g,"\\/")+"$");r=i.exec(e);if(r){n=t[s];break}}if(!n)return false;return{route:n,args:r,regex:i}},state_change:function(e,n){if(e&&e.stop!=t)e=false;if(e)e=this.debasify(e);if(!e)e=this.cur_path();n=!!n;if(this.last_path==e&&!n){return false}this.last_path=e;if(!this.options.process_querystring)e=e.replace(/\?.*/,"");e=new String(e);var r={path:e};this.trigger("preroute",r);this.trigger("route",r.path)},last_url:function(){return this._last_url},bind_links:function(t){t||(t={});var n=function(n){if(n.control||n.shift||n.alt)return;var r=Composer.find_parent("a",n.target);var i=typeof n.button!="undefined"?n.button:n.event.button;if(r.href.match(/^javascript:/))return false;if(History.emulated.pushState&&r.href.replace(/^.*?#/,"")==""){return false}if(r.target=="_blank"||i>0)return;var s=(new String(e.location)).replace(/[a-z]+:\/\/(.*?)\/.*/i,"$1");var o=r.href.match(/^[a-z]+:\/\//)?r.href.replace(/[a-z]+:\/\/(.*?)\/.*/i,"$1"):s;if(s!=o||typeof t.do_state_change=="function"&&!t.do_state_change(r)){return}if(n)n.stop();var u=r.href.replace(/^[a-z]+:\/\/.*?\//,"").replace(/^[#!\/]+/,"");if(t.filter_trailing_slash)u=u.replace(/\/$/,"");u="/"+u;this.route(u,{state:t.global_state});return false}.bind(this);if(t.selector){var r=t.selector}else{if(t.exclude_class){var r='a:not([class~="'+t.exclude_class+'"])'}else{var r="a"}}Composer.add_event(document.body,"click",n,r)}});Composer.exp0rt({Router:n})}).apply(typeof exports!="undefined"?exports:this);(function(){"use strict";var e=this;var t=Composer.Model.extend({relations:false,relation_data:{},skip_relational_serialize:false,initialize:function(t,n){n||(n={});if(this.relations){Composer.object.each(this.relations,function(t,n){if(t.model&&typeof t.model=="string"){t.model=this._get_key(e,t.model)}else if(t.collection&&typeof t.collection=="string"){t.collection=this._get_key(e,t.collection)}else if(t.filter_collection&&typeof t.filter_collection=="string"){t.filter_collection=this._get_key(e,t.filter_collection);var r=t.master;if(typeof r=="string"){var i=t.master;t.master=function(){var e=this._get_key(this.relation_data,i);if(!e){e=new this.relations[i].collection;this._set_key(this.relation_data,i)}return e}.bind(this);t.master()}}if(!t.delayed_init){var s=this._create_obj(t,n,{set_parent:true})}},this)}return this.parent(t,n)},toJSON:function(e){e||(e={});var t=this.parent();if(this.skip_relational_serialize||e.skip_relational){Object.keys(this.relations).forEach(function(e){delete t[e]})}return t},set:function(e,t){t||(t={});if(this.relations&&!t.skip_relational){Composer.object.each(this.relations,function(n,r){var i=this._get_key(e,r);if(typeof i=="undefined")return;var s=Composer.object.clone(t);s.data=i;var o=this._create_obj(n,r,s)},this)}return this.parent(e,t)},get:function(e,t){var n=this._get_key(this.relation_data,e);if(typeof n!="undefined")return n;return this.parent(e,t)},clear:function(e){e||(e={});if(this.relations&&!e.skip_relational){Composer.object.each(this.relations,function(e,t){var n=this._get_key(this.relation_data,t);if(typeof n=="undefined")return;if(n.clear&&typeof n.clear=="function")n.clear()},this)}return this.parent.apply(this,arguments)},bind_relational:function(e){var t=this.relations[e];if(!t)return false;var n=this._create_obj(t,e);var r=Array.prototype.slice.call(arguments,0);n.bind.apply(n,r.slice(1))},unbind_relational:function(e){var t=this.relations[e];if(!t)return false;var n=this._get_key(this.relation_data,e);if(!n)return false;var r=Array.prototype.slice.call(arguments,0);n.unbind.apply(n,r.slice(1))},set_parent:function(e,t){t.get_parent=function(){return e}},get_parent:function(e){return e.get_parent()},_create_obj:function(e,t,n){n||(n={});var r=n.data;delete n.data;if(r&&r.__composer_type&&r.__composer_type!=""){var i=r}else{var i=this._get_key(this.relation_data,t);var s=e.collection||e.filter_collection?"collection":"model";switch(s){case"model":i||(i=new e.model);if(n.set_parent)this.set_parent(this,i);if(r)i.set(r);break;case"collection":if(!i){if(e.collection){i=new e.collection}else if(e.filter_collection){i=new e.filter_collection(e.master(),Composer.object.merge({skip_initial_sync:true},e.options))}}if(n.set_parent)this.set_parent(this,i);if(r)i.reset(r,n);break}}this._set_key(this.relation_data,t,i);this.trigger("relation",i,t);this.trigger("relation:"+t,i);return i},_set_key:function(e,t,n){e||(e={});var r=t.split(".");var i=e;for(var s=0,o=r.length;s<o;s++){var u=r[s];if(s==o-1){i[u]=n;break}if(!i[u]){i[u]={}}else if(typeof i!="object"||Composer.array.is(i)){i[u]={}}i=i[u]}return e},_get_key:function(e,t){e||(e={});var n=t.split(".");var r=e;for(var i=0,s=n.length;i<s;i++){var o=n[i];var u=typeof r[o];if(u=="undefined"){return r[o]}r=r[o]}return r}});Composer.merge_extend(t,["relations"]);Composer.exp0rt({HasOne:-1,HasMany:-1,RelationalModel:t})}).apply(typeof exports!="undefined"?exports:this);(function(){"use strict";var e=Composer.Collection.extend({__composer_type:"filtercollection",master:null,filter:function(){return true},transform:null,limit:false,options:{forward_all_events:false,refresh_on_change:false,sort_event:false},initialize:function(e,t){t||(t={});var n=Object.keys(this.options);Object.keys(t).forEach(function(e){var r=t[e];if(typeof r=="function")r=r.bind(this);if(n.indexOf(e)>=0){this.options[e]=r}else{this[e]=r}}.bind(this));this.parent();this.master=e;if(!this.master)return false;if(!this.filter)return false;this.attach(t);if(!t.skip_initial_sync)this.refresh()},attach:function(){this.master.bind("all",this.match_action.bind(this),"filtercollection:"+this.cid()+":all");this.bind("reset",function(e){e||(e={});if(e.has_reload)return false;this.refresh(e)}.bind(this),"filtercollection:reset")},detach:function(){this.master.unbind("all","filtercollection:"+this.cid()+":all");this.unbind("reset","filtercollection:reset")},match_action:function(e,t){var n=Array.prototype.slice.call(arguments,0);switch(e){case"add":this.add_event(t,{from_event:true});break;case"reset":this.refresh();break;case"clear":this.clear();break;case"remove":this.remove_event(t,{from_event:true});break;case"change":this.change_event(t,{},n);break;case"sort":this.refresh();break;default:this.forward_event(e,t,n);break}},refresh:function(e){e||(e={});if(e.diff_events){var t=this._models}this._models=this.master._models.filter(function(e){return this.filter(e,this)}.bind(this));this.sort({silent:true});if(this.limit)this._models.splice(this.limit,this._models.length);if(e.diff_events){var n=function(e,t){return e.filter(function(e){return t.indexOf(e)<0})};n(t,this._models).forEach(function(t){this.fire_event("remove",e,t)},this);n(this._models,t).forEach(function(t){this.fire_event("add",e,t)},this)}this.fire_event("reset",e,{has_reload:true})},change_event:function(e,t,n){t||(t={});if(!e||this.models().indexOf(e)<0||!this.filter(e,this))return false;var r=this._models.length;if(this.options.refresh_on_change){this.refresh({silent:true})}else{var i=this._models.indexOf(e);var s=this.sort_index(e);if(i==-1&&this.filter(e,this)){this.add(e,t)}else if(i>-1&&!this.filter(e,this)){this.remove(e,t)}else if(i!=s){if(this.options.sort_event){this.sort(Composer.object.merge({},t,{silent:true}));this.fire_event("sort",t)}else{this.sort(t)}}}if(this._models.length==r){n.shift();var o=["change",t].concat(n);this.fire_event.apply(this,o)}else{this.fire_event("reset",t)}},add:function(e,t){if(Composer.array.is(e)){return Composer.object.each(e,function(e){this.add(e,t)},this)}t||(t={});if(typeof t.transform=="undefined")t.transform=true;var n=e.__composer_type=="model"?e:new this.master.model(e,t);if(this.transform&&t.transform){n=this.transform.call(this,n,"add")}if(!this.filter(n,this))return false;if(typeof t.at=="number"){var r=this.at(t.at);var i=this.master.index_of(r);if(i!==false){t.at=i}}if(this.master.index_of(n)){this._do_add(n,t)}else{this.master.add(n,t);if(this.limit)this._models.splice(this.limit)}return n},_do_add:function(e,t){this._models.push(e);var n=this._models.indexOf(e);this.sort({silent:true});var r=this._models.indexOf(e);if(this.limit)this._models.splice(this.limit);if(this.index_of(e)){this.fire_event("add",t,e,this,t);if(n!=r){if(this.options.sort_event){this.fire_event("sort",t)}else{this.fire_event("reset",t)}}}},remove:function(e,t){if(Composer.array.is(e)){return Composer.object.each(e,function(e){this.remove(e)},this)}t||(t={});if(typeof t.transform=="undefined")t.transform=true;if(this._models.indexOf(e)<0)return false;if(this.transform&&t.transform){e=this.transform.call(this,e,"remove")}Composer.array.erase(this._models,e);this.fire_event("remove",t,e);this._remove_reference(e)},add_event:function(e,t){if(!this.filter(e,this))return false;this.refresh({silent:true});if(this.options.sort_event)this.fire_event("sort",t);this.fire_event("add",t,e,this,t)},remove_event:function(e,t){if(this._models.indexOf(e)<0)return false;this.refresh({silent:true});this.fire_event("remove",t,e)},forward_event:function(e,t,n){if(!this.options.forward_all_events)return false;if(t&&t.__composer_type=="model"&&!this.filter(t,this)){return false}this.trigger.apply(this,n)}});Composer.exp0rt({FilterCollection:e})})()